<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=340, initial-scale=1.0, user-scalable=no">
    <title>TonCloude</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="balance-section">
                <div class="balance-item diamond">
                    <svg class="balance-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 3h12l4 6-10 12L2 9z"/><path d="M2 9h20"/>
                    </svg>
                    <span id="diamondBalance">0</span>
                </div>
                <div class="balance-item gold">
                    <svg class="balance-icon" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="10"/>
                    </svg>
                    <span id="goldBalance">0</span>
                </div>
                <div class="balance-item ton">
                    <svg class="balance-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="12,2 22,8.5 22,15.5 12,22 2,15.5 2,8.5"/>
                    </svg>
                    <span id="tonBalance">0</span>
                </div>
            </div>
            <button class="create-btn" onclick="showPage('create')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                CREATE
            </button>
        </header>

        <!-- Pages Container -->
        <main class="main-content">
            <!-- EARN PAGE -->
            <div class="page active" id="earnPage">
                <!-- Daily Tasks -->
                <section class="task-section">
                    <h2 class="section-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        Daily Tasks
                    </h2>
                    <div class="task-list" id="dailyTasks"></div>
                </section>

                <!-- Promo Code -->
                <section class="promo-section">
                    <div class="promo-card">
                        <svg class="promo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 12 20 22 4 22 4 12"/>
                            <rect x="2" y="7" width="20" height="5"/>
                            <line x1="12" y1="22" x2="12" y2="7"/>
                        </svg>
                        <input type="text" id="promoCode" placeholder="Enter promo code" maxlength="20">
                        <button onclick="claimPromoCode()">CLAIM</button>
                    </div>
                </section>

                <!-- Channel Tasks -->
                <section class="task-section">
                    <h2 class="section-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        Channel Tasks
                    </h2>
                    <div class="task-list" id="channelTasks"><div class="loading"></div></div>
                </section>

                <!-- Bot Tasks -->
                <section class="task-section">
                    <h2 class="section-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="10" rx="2"/>
                            <circle cx="12" cy="5" r="3"/>
                        </svg>
                        Bot Tasks
                    </h2>
                    <div class="task-list" id="botTasks"><div class="loading"></div></div>
                </section>

                <!-- Other Tasks -->
                <section class="task-section">
                    <h2 class="section-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                        Other Tasks
                    </h2>
                    <div class="task-list" id="otherTasks"><div class="loading"></div></div>
                </section>
            </div>

            <!-- ADS PAGE (Single Task with Limit) -->
            <div class="page" id="adsPage">
                <div class="page-header">
                    <div class="ads-hero-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="2" y="3" width="20" height="14" rx="2"/>
                            <path d="M8 21h8"/><path d="M12 17v4"/>
                            <polygon points="10 8 10 12 14 10 10 8"/>
                        </svg>
                    </div>
                    <h1>Watch Ads & Earn</h1>
                    <p>Watch video ads to earn rewards!</p>
                </div>

                <!-- Single Ad Card with Progress -->
                <div class="ads-main-card">
                    <div class="ads-card-header">
                        <div class="ads-card-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                        </div>
                        <div class="ads-card-info">
                            <h2>Video Ads</h2>
                            <p>Daily limit: 10 ads</p>
                        </div>
                    </div>

                    <div class="ads-reward-box">
                        <div class="reward-item">
                            <span class="reward-icon">ü™ô</span>
                            <span class="reward-text">+250 Gold</span>
                        </div>
                        <div class="reward-item">
                            <span class="reward-icon">üíé</span>
                            <span class="reward-text">+2 Diamond</span>
                        </div>
                        <span class="per-ad-text">per ad</span>
                    </div>

                    <!-- Progress Bar -->
                    <div class="ads-progress-section">
                        <div class="progress-header">
                            <span>Today's Progress</span>
                            <span id="adsProgressText">0/10</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="adsProgressBar" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Today's Earnings -->
                    <div class="ads-earnings">
                        <div class="earning-item">
                            <span>Earned Today:</span>
                            <span id="adsTodayGold">0 Gold</span>
                        </div>
                        <div class="earning-item">
                            <span>Diamonds:</span>
                            <span id="adsTodayDiamond">0 üíé</span>
                        </div>
                    </div>

                    <!-- Watch Button -->
                    <button class="ads-watch-btn" id="watchAdBtn" onclick="watchAd()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        Watch Ad
                    </button>

                    <p class="ads-note" id="adsNote">You can watch 10 more ads today</p>
                </div>
            </div>

            <!-- NFT PAGE (With Tabs - Coming Soon) -->
            <div class="page" id="nftPage">
                <div class="page-header">
                    <h1>Collection</h1>
                    <p>NFTs & Gifts</p>
                </div>

                <!-- Tabs -->
                <div class="nft-tabs">
                    <button class="nft-tab active" onclick="switchNftTab('gift')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 12 20 22 4 22 4 12"/>
                            <rect x="2" y="7" width="20" height="5"/>
                            <line x1="12" y1="22" x2="12" y2="7"/>
                            <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/>
                            <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
                        </svg>
                        GIFT
                    </button>
                    <button class="nft-tab" onclick="switchNftTab('nft')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <path d="M21 15l-5-5L5 21"/>
                        </svg>
                        NFT
                    </button>
                </div>

                <!-- GIFT Tab Content -->
                <div class="nft-tab-content active" id="giftTabContent">
                    <div class="coming-soon-box">
                        <div class="coming-soon-icon">üéÅ</div>
                        <h2>Gifts Coming Soon!</h2>
                        <p>Exciting gift rewards are on the way. Stay tuned for exclusive surprises!</p>
                        <div class="coming-soon-features">
                            <div class="feature-item">
                                <span class="feature-icon">üéâ</span>
                                <span>Daily Gifts</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üíé</span>
                                <span>Premium Rewards</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üèÜ</span>
                                <span>Special Events</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NFT Tab Content -->
                <div class="nft-tab-content" id="nftTabContent">
                    <div class="coming-soon-box">
                        <div class="coming-soon-icon">üñºÔ∏è</div>
                        <h2>NFTs Coming Soon!</h2>
                        <p>Collect unique digital assets and earn exclusive rewards!</p>
                        <div class="coming-soon-features">
                            <div class="feature-item">
                                <span class="feature-icon">ü¶Å</span>
                                <span>Rare NFTs</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üí∞</span>
                                <span>Trade & Sell</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">‚ú®</span>
                                <span>Bonus Rewards</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REFER PAGE -->
            <div class="page" id="referPage">
                <div class="refer-hero">
                    <svg class="refer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <h1>Invite Friends</h1>
                    <p>Earn 1000 Gold + 10 Diamond per referral!</p>
                </div>
                <div class="refer-stats">
                    <div class="stat-card">
                        <span class="stat-value" id="totalReferrals">0</span>
                        <span class="stat-label">Total Referrals</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="earnedFromReferrals">0</span>
                        <span class="stat-label">Earned Gold</span>
                    </div>
                </div>
                <section class="refer-link-section">
                    <h2 class="section-title">Your Referral Link</h2>
                    <div class="refer-link-box">
                        <input type="text" id="referralLink" readonly value="Loading...">
                        <button onclick="copyReferralLink()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                        </button>
                    </div>
                    <button class="share-btn" onclick="shareReferralLink()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                        </svg>
                        Share with Friends
                    </button>
                </section>
                <section class="referral-list-section">
                    <h2 class="section-title">Your Referrals</h2>
                    <div class="referral-list" id="referralList">
                        <div class="empty-state"><p>No referrals yet</p></div>
                    </div>
                </section>
            </div>

            <!-- WALLET PAGE -->
            <div class="page" id="walletPage">
                <div class="wallet-hero">
                    <svg class="wallet-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/>
                        <path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/>
                        <path d="M18 12a2 2 0 0 0 0 4h4v-4z"/>
                    </svg>
                    <h1>My Wallet</h1>
                </div>
                <div class="balance-cards">
                    <div class="balance-card gold-card">
                        <span class="card-label">Gold</span>
                        <span class="card-value" id="walletGold">0</span>
                    </div>
                    <div class="balance-card diamond-card">
                        <span class="card-label">Diamond</span>
                        <span class="card-value" id="walletDiamond">0</span>
                    </div>
                    <div class="balance-card ton-card">
                        <span class="card-label">TON</span>
                        <span class="card-value" id="walletTon">0.00</span>
                    </div>
                </div>
                <div class="wallet-actions">
                    <button class="action-btn" onclick="showModal('depositModal')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 3v12"/><path d="M8 11l4 4 4-4"/>
                            <path d="M3 17v3a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-3"/>
                        </svg>
                        Deposit
                    </button>
                    <button class="action-btn" onclick="showModal('withdrawModal')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 17V5"/><path d="M8 9l4-4 4 4"/>
                            <path d="M3 17v3a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-3"/>
                        </svg>
                        Withdraw Gold
                    </button>
                </div>
                <section class="info-section">
                    <h2 class="section-title">Withdrawal Info</h2>
                    <div class="info-card">
                        <div class="info-row"><span>Minimum:</span><span>100,000 Gold</span></div>
                        <div class="info-row"><span>Fee:</span><span>20,000 Diamond / 100K Gold</span></div>
                    </div>
                </section>
                <section class="transaction-section">
                    <h2 class="section-title">Withdrawal History</h2>
                    <div class="transaction-list" id="transactionList">
                        <div class="empty-state"><p>No withdrawal history</p></div>
                    </div>
                </section>
            </div>

            <!-- CREATE PAGE (Updated with Link Validation) -->
            <div class="page" id="createPage">
                <div class="create-header-bar">
                    <button class="back-btn" onclick="showPage('earn')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/>
                        </svg>
                        Back
                    </button>
                    <h2>Create Task</h2>
                </div>
                <div class="task-type-section">
                    <h3>Select Task Type</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="taskType" value="channel" checked onchange="updateLinkPlaceholder()">
                            <span>Channel</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="taskType" value="bot" onchange="updateLinkPlaceholder()">
                            <span>Bot</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="taskType" value="other" onchange="updateLinkPlaceholder()">
                            <span>Other</span>
                        </label>
                    </div>
                </div>
                <form class="create-form" id="createTaskForm" onsubmit="submitTask(event)">
                    <div class="form-group">
                        <label>Task Title (Max 10 words)</label>
                        <input type="text" id="taskTitle" placeholder="Enter title" required>
                    </div>
                    <div class="form-group">
                        <label>Link</label>
                        <input type="url" id="taskLink" placeholder="https://t.me/channelname" required oninput="validateLink()">
                        <span class="link-hint" id="linkHint">Link must be: https://t.me/channelname</span>
                        <span class="link-error" id="linkError"></span>
                    </div>
                    <div class="form-group">
                        <label>TON Amount (Min: 0.5)</label>
                        <input type="number" id="tonAmount" placeholder="0.5" min="0.5" step="0.1" required oninput="calculateMaxUsers()">
                    </div>
                    <div class="form-group">
                        <label>Maximum Users</label>
                        <input type="number" id="maxUsers" readonly placeholder="Auto calculated">
                    </div>
                    <div class="cost-summary">
                        <div class="cost-row"><span>Cost:</span><span id="taskCost">0 TON</span></div>
                        <div class="cost-row"><span>Balance:</span><span id="yourBalance">0 TON</span></div>
                        <div class="cost-row total"><span>After:</span><span id="afterBalance">0 TON</span></div>
                    </div>
                    <button type="submit" class="submit-btn" id="createBtn">Create Task</button>
                </form>
            </div>
        </main>

        <!-- Bottom Navigation (5 items) -->
        <nav class="bottom-nav">
            <a class="nav-item active" onclick="showPage('earn')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M8 12l2 2 4-4"/>
                </svg>
                <span>Earn</span>
            </a>
            <a class="nav-item" onclick="showPage('ads')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
                <span>Ads</span>
            </a>
            <a class="nav-item" onclick="showPage('nft')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/>
                </svg>
                <span>NFT</span>
            </a>
            <a class="nav-item" onclick="showPage('refer')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                </svg>
                <span>Refer</span>
            </a>
            <a class="nav-item" onclick="showPage('wallet')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/>
                    <path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/>
                    <path d="M18 12a2 2 0 0 0 0 4h4v-4z"/>
                </svg>
                <span>Wallet</span>
            </a>
        </nav>
    </div>

    <!-- MODALS -->
    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Deposit TON</h2>
                <button class="close-btn" onclick="closeModal('depositModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <p>Send TON to this address:</p>
                <div class="copy-box">
                    <input type="text" readonly value="UQDqx6Ds4sZdlQI9ooU22YM0eBSqxIx03rPF2ylB35a3xdWc" id="depositAddress">
                    <button onclick="copyText('depositAddress')">Copy</button>
                </div>
                <div class="memo-box">
                    <p class="memo-label">‚ö†Ô∏è MEMO (VERY IMPORTANT!):</p>
                    <div class="copy-box">
                        <input type="text" readonly id="memoValue" value="">
                        <button onclick="copyText('memoValue')">Copy</button>
                    </div>
                    <p class="warning">Without correct memo, your deposit will be LOST!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Withdraw Gold</h2>
                <button class="close-btn" onclick="closeModal('withdrawModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="balance-info">
                    <span>Gold: <strong id="modalGold">0</strong></span>
                    <span>Diamond: <strong id="modalDiamond">0</strong></span>
                </div>
                <div class="form-group">
                    <label>Gold Amount (Min: 100,000)</label>
                    <input type="number" id="withdrawGoldAmount" placeholder="100000" min="100000" step="100000" oninput="calculateFee()">
                </div>
                <div class="form-group">
                    <label>TON Wallet Address</label>
                    <input type="text" id="withdrawAddress" placeholder="Your TON wallet">
                </div>
                <div class="fee-info">
                    <div><span>Gold:</span><span id="wdGold">0</span></div>
                    <div><span>Fee:</span><span id="wdFee">0 Diamond</span></div>
                </div>
                <button class="submit-btn" onclick="processWithdraw()">Withdraw</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- Monetag SDK -->
    <script src='//libtl.com/sdk.js' data-zone='10378142' data-sdk='show_10378142'></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- App Scripts -->
    <script src="js/firebase.js"></script>
    <script src="js/app.js"></script>
</body>
</html>